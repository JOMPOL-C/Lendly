<%- include('includes/head') %>
    <link rel="stylesheet" href="/styles/review.css">
    </head>

    <body>
        <%- include('includes/nav') %>
            <main>
                <section class="index">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <h2>รีวิวจากผู้ใช้</h2>
                        <a href="/write_review" class="write-review-btn"
                            style="background:#6d28d9; color:white; padding:10px 18px; border-radius:10px; text-decoration:none; font-weight:600; transition:0.2s;">
                            ✍️ เขียนรีวิว
                        </a>
                    </div>

                    <div id="review-container">
                        <% if (reviews && reviews.length> 0) { %>
                            <% reviews.forEach(review=> { %>
                                <div class="review-item">
                                    <div class="user-profile">
                                        <img src="<%= review.customer?.profile_image_url || '/images/default-user.png' %>"
                                            alt="" style="width:50px;height:50px;border-radius:50%;object-fit:cover;">
                                        <h5>
                                            <%= review.customer?.username || 'ไม่ระบุชื่อ' %>
                                        </h5>
                                    </div>

                                    <div class="review-content">
                                        <span>
                                            <%= review.reviewText %>
                                        </span>
                                        <p style="color:#888;">สินค้า: <%= review.product?.product_name %>
                                        </p>

                                        <% if (review.images && review.images.length> 0) { %>
                                            <div class="rev-img-group">
                                                <% review.images.forEach((img, index)=> { %>
                                                    <div class="rev-img-col">
                                                        <img src="<%= img.image_url || '/images/no-image.png' %>"
                                                            alt="review-image" onclick="openLightbox(<%= index %>)">
                                                    </div>
                                                    <% }) %>
                                            </div>
                                            <% } %>
                                    </div>
                                </div>
                                <% }) %>
                                    <% } else { %>
                                        <p style="text-align:center; color:#777;">ยังไม่มีรีวิวจากผู้ใช้</p>
                                        <% } %>
                    </div>

                    <div id="lightbox" class="lightbox">
                        <span class="close" onclick="closeLightbox()">&times;</span>
                        <span class="prev" onclick="changeSlide(-1)">&#10094;</span>
                        <span class="next" onclick="changeSlide(1)">&#10095;</span>
                        <img id="lightbox-img" src="">
                    </div>
                </section>
            </main>

            <%- include('includes/footer') %>
                <%- include('includes/chatWidget') %>
                    <script src="/js/script.js"></script>

                    <script>
                        // ฟังก์ชันเปิด Lightbox ดูภาพรีวิว
                        const images = document.querySelectorAll(".rev-img-group img");
                        const lightbox = document.getElementById("lightbox");
                        const lightboxImg = document.getElementById("lightbox-img");
                        let currentIndex = 0;

                        function openLightbox(index) {
                            currentIndex = index;
                            lightbox.style.display = "flex";
                            lightboxImg.src = images[index].src;
                        }

                        function closeLightbox() {
                            lightbox.style.display = "none";
                        }

                        function changeSlide(step) {
                            currentIndex += step;
                            if (currentIndex < 0) currentIndex = images.length - 1;
                            if (currentIndex >= images.length) currentIndex = 0;
                            lightboxImg.src = images[currentIndex].src;
                        }
                    </script>
    </body>

    </html>