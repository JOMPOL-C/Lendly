<%- include('includes/head') %>
<link rel="stylesheet" href="/styles/adminDashboard.css">
</head>
<body>
  <%- include('includes/navAdmin') %>

  <main class="dashboard-container">
    <h2>‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏£‡∏∞‡∏ö‡∏ö Lendly</h2>

    <section class="stats-summary">
      <div class="card">
        <h3>‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÄ‡∏ä‡πà‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
        <p><%= totalRentals %></p>
      </div>
      <div class="card">
        <h3>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡πà‡∏≤‡∏≠‡∏¢‡∏π‡πà</h3>
        <p><%= activeRentals %></p>
      </div>
      <div class="card">
        <h3>‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</h3>
        <p><%= waitingRentals %></p>
      </div>
      <div class="card">
        <h3>‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÅ‡∏•‡πâ‡∏ß</h3>
        <p><%= cancelledRentals %></p>
      </div>
      <div class="card highlight">
        <h3>‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏°</h3>
        <p><%= totalRevenue.toLocaleString() %> ‡∏ö‡∏≤‡∏ó</p>
      </div>
    </section>

    <!-- üìä ‡∏Å‡∏£‡∏≤‡∏ü‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
    <section class="chart-section">
      <h3>‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</h3>
      <canvas id="revenueChart" width="400" height="200"></canvas>
    </section>

    <section class="chart-section">
        <h3>‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏°</h3>
        <div style="text-align:center; margin-bottom:15px;">
          <button onclick="loadTopStats()">üìä ‡∏î‡∏π‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏°</button>
        </div>
        <div id="top-stats"></div>
      </section> -->
      

  <!-- ‚úÖ ‡πÇ‡∏´‡∏•‡∏î Chart.js ‡∏´‡∏•‡∏±‡∏á DOM -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
  <script defer>
    document.addEventListener('DOMContentLoaded', () => {
      const monthLabels = <%- JSON.stringify(monthLabels) %>;
      const monthlyRevenue = <%- JSON.stringify(monthlyRevenue) %>;
      const statusCounts = <%- JSON.stringify(statusCounts) %>;

      const ctx1 = document.getElementById('revenueChart').getContext('2d');
      new Chart(ctx1, {
        type: 'line',
        data: {
          labels: monthLabels,
          datasets: [{
            label: '‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (‡∏ö‡∏≤‡∏ó)',
            data: monthlyRevenue,
            borderColor: '#8b5cf6',
            backgroundColor: 'rgba(139,92,246,0.2)',
            tension: 0.3,
            fill: true,
            pointRadius: 4,
            pointHoverRadius: 6
          }]
        },
        options: {
          plugins: { legend: { display: false } },
          scales: {
            y: { beginAtZero: true, ticks: { callback: v => v.toLocaleString() } }
          }
        }
      });

      const ctx2 = document.getElementById('rentalStatusChart').getContext('2d');
      new Chart(ctx2, {
        type: 'doughnut',
        data: {
          labels: ['‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥', '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡πà‡∏≤', '‡∏Ñ‡∏∑‡∏ô‡πÅ‡∏•‡πâ‡∏ß', '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'],
          datasets: [{
            data: statusCounts,
            backgroundColor: ['#fde68a','#a5b4fc','#bbf7d0','#fecaca']
          }]
        },
        options: {
          plugins: { legend: { position: 'bottom' } }
        }
      });
    });
  </script>

<script>
    async function loadTopStats() {
      const res = await fetch('/admin/top-stats');
      const data = await res.json();
    
      const html = `
        <div class="top-box">
          <h4>üõçÔ∏è ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡πÄ‡∏ä‡πà‡∏≤‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</h4>
          <ul>
            ${data.topProducts.map(p => `<li>${p.product_name} - ${p.count} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</li>`).join('')}
          </ul>
          <h4>üè∑Ô∏è ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏°</h4>
          <ul>
            ${data.topCategories.map(c => `<li>${c.category_name} - ${c.count} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</li>`).join('')}
          </ul>
        </div>
      `;
      document.getElementById('top-stats').innerHTML = html;
    }
    </script>
    
</body>
</html>
