<%- include('includes/head') %>
    <link rel="stylesheet" href="/styles/rental.css">
    <link rel="stylesheet" href="/styles/review.css">
    <link rel="stylesheet" href="/styles/add_product.css">
    <link rel="stylesheet" href="/styles/edit_product.css">
    </head>

    <body>
        <%- include('includes/navAdmin') %>
            <main>
                <section class="index">
                    <h2>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2>

                    <form action="/api/products/<%= product.product_id %>/update" method="POST"
                        enctype="multipart/form-data">
                        <div class="form-group">
                            <label>‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
                            <input type="text" name="product_name" value="<%= product.product_name %>" required>
                        </div>

                        <div class="form-group">
                            <label>‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á</label>
                            <input type="text" name="story_name" value="<%= product.story_name %>" required>
                        </div>

                        <div class="form-group">
                            <label>‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô (‡∏ã‡∏°.)</label>
                            <div style="display:flex; gap:10px;">
                                <input type="number" name="chest" value="<%= product.size?.chest %>" placeholder="‡∏≠‡∏Å"
                                    step="0.1">
                                <input type="number" name="waist" value="<%= product.size?.waist %>" placeholder="‡πÄ‡∏≠‡∏ß"
                                    step="0.1">
                                <input type="number" name="hips" value="<%= product.size?.hips %>" placeholder="‡∏™‡∏∞‡πÇ‡∏û‡∏Å"
                                    step="0.1">
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="product_images">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡πÉ‡∏´‡∏°‡πà (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 10 ‡∏£‡∏π‡∏õ)</label>
                            <input type="file" id="product_images" name="product_images" accept="image/*" multiple>

                            <% if (product.images && product.images.length> 0) { %>
                                <p style="margin-top:10px;">‡∏£‡∏π‡∏õ‡πÄ‡∏î‡∏¥‡∏°:</p>
                                <div id="old-images" style="display:flex; gap:10px; flex-wrap:wrap;">
                                    <% product.images.forEach(img=> { %>
                                        <div class="image-box" data-id="<%= img.image_id %>"
                                            style="position:relative; display:inline-block;">
                                            <img src="<%= img.image_url %>" alt="Product Image"
                                                style="max-width:150px; border-radius:10px;">
                                            <button type="button" class="remove-btn">√ó</button>
                                        </div>
                                        <% }) %>
                                </div>
                                <% } %>
                        </div>

                        <!-- üëá ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏ï‡∏¥‡∏° input hidden ‡∏ï‡∏≠‡∏ô‡∏Ñ‡∏•‡∏¥‡∏Å‡∏•‡∏ö -->
                        <div id="removed-container"></div>


                        <div class="form-group">
                            <label>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
                            <textarea name="shipping_info" rows="4" required><%= product.shipping_info %></textarea>
                        </div>

                        <div class="form-group">
                            <label>‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</label>
                            <div class="checkbox-group">
                                <label><input type="checkbox" id="useTest" name="usage" value="test"
                                        <%=product.prices.some(p=> p.type === 'suit' && p.days_test) ? 'checked' : ''
                                    %>> ‡πÄ‡∏ó‡∏™</label>
                                <label><input type="checkbox" id="usePry" name="usage" value="pri"
                                        <%=product.prices.some(p=> p.type === 'suit' && p.days_pri) ? 'checked' : '' %>>
                                    ‡πÑ‡∏û‡∏£</label>
                            </div>
                        </div>

                        <div id="daysTestField">
                            <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô (Test)</label>
                            <input type="number" name="days_suit_test"
                                value="<%= product.prices.find(p => p.type === 'suit')?.days_test || '' %>">
                        </div>

                        <div id="daysPriField">
                            <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô (Pri)</label>
                            <input type="number" name="days_suit_pri"
                                value="<%= product.prices.find(p => p.type === 'suit')?.days_pri || '' %>">
                        </div>

                        <div class="form-group">
                            <label>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
                            <select name="categoryId" required>
                                <% categories.forEach(c=> { %>
                                    <option value="<%= c.category_id %>" <%=c.category_id===product.categoryId
                                        ? 'selected' : '' %>>
                                        <%= c.category_name %>
                                    </option>
                                    <% }) %>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>‡∏Ç‡∏≠‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏ä‡πà‡∏≤</label>
                            <div class="checkbox-group">
                                <label><input type="checkbox" name="rentalType[]" id="rentCostume" value="costume"
                                        <%=product.prices.some(p=> p.type === 'suit') ? 'checked' : '' %>> ‡∏ä‡∏∏‡∏î</label>
                                <label><input type="checkbox" name="rentalType[]" id="rentWig" value="wig"
                                        <%=product.prices.some(p=> p.type === 'wig') ? 'checked' : '' %>> ‡∏ß‡∏¥‡∏Å</label>
                                <label><input type="checkbox" name="rentalType[]" id="rentProp" value="prop"
                                        <%=product.prices.some(p=> p.type === 'solo_prop') ? 'checked' : '' %>>
                                    ‡∏û‡∏£‡πá‡∏≠‡∏û</label>
                                <label><input type="checkbox" name="rentalType[]" id="rentShoe" value="shoe"
                                        <%=product.prices.some(p=> p.type === 'solo_shoe') ? 'checked' : '' %>>
                                    ‡∏£‡∏≠‡∏á‡πÄ‡∏ó‡πâ‡∏≤</label>
                            </div>
                        </div>

                        <div id="priceCostume" class="price-field">
                            <label>‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏ä‡∏∏‡∏î</label>
                            <input type="number" name="price_costume"
                                value="<%= product.prices.find(p => p.type === 'suit')?.price_test || '' %>">
                        </div>

                        <div id="priceWig" class="price-field">
                            <label>‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏ß‡∏¥‡∏Å</label>
                            <input type="number" name="price_wig"
                                value="<%= product.prices.find(p => p.type === 'wig')?.price_test || '' %>">
                        </div>

                        <div id="priceProp" class="price-field">
                            <label>‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏û‡∏£‡πá‡∏≠‡∏û</label>
                            <input type="number" name="price_prop"
                                value="<%= product.prices.find(p => p.type === 'solo_prop')?.price_test || '' %>">
                        </div>

                        <div id="priceShoe" class="price-field">
                            <label>‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏£‡∏≠‡∏á‡πÄ‡∏ó‡πâ‡∏≤</label>
                            <input type="number" name="price_shoe"
                                value="<%= product.prices.find(p => p.type === 'solo_shoe')?.price_test || '' %>">
                        </div>

                        <div id="pricePryExtra" class="price-field">
                            <label>‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÑ‡∏û‡∏£</label>
                            <input type="number" name="price_pry_extra"
                                value="<%= product.prices.find(p => p.price_pry_extra)?.price_pry_extra || '' %>">
                        </div>

                        <div class="form-group">
                            <label>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏°‡∏±‡∏î‡∏à‡∏≥‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡∏ö‡∏≤‡∏ó)</label>
                            <input type="number" name="deposit" value="<%= product.prices[0]?.Deposit || '' %>" <p
                                class="note">** ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏°‡∏±‡∏î‡∏à‡∏≥‡∏à‡∏∞‡∏Ñ‡∏∑‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ñ‡∏∑‡∏ô‡∏ï‡∏≤‡∏°‡∏™‡∏†‡∏≤‡∏û **</p>
                        </div>

                        <div class="form-group">
                            <label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
                            <select name="status" required>
                                <option value="active" <%=product.product_status ? "selected" : "" %>>‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡πÄ‡∏ä‡πà‡∏≤
                                </option>
                                <option value="inactive" <%=!product.product_status ? "selected" : "" %>>‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πà‡∏≤
                                </option>
                            </select>
                        </div>

                        <button type="submit" class="submit-btn">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                    </form>
                </section>
            </main>


            <script src="/js/script.js"></script>
            <script src="/js/add_product.js"></script>
            <script>
                document.addEventListener("DOMContentLoaded", () => {
                    const oldImages = document.querySelectorAll(".image-box");
                    const removedContainer = document.getElementById("removed-container");

                    oldImages.forEach(box => {
                        const btn = box.querySelector(".remove-btn");
                        btn.addEventListener("click", () => {
                            const imageId = box.getAttribute("data-id");

                            // ‡∏™‡∏£‡πâ‡∏≤‡∏á hidden input ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á id ‡∏Ç‡∏≠‡∏á‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö
                            const input = document.createElement("input");
                            input.type = "hidden";
                            input.name = "removeImages";
                            input.value = imageId;
                            removedContainer.appendChild(input);

                            // ‡∏•‡∏ö‡∏£‡∏π‡∏õ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤ (‡πÑ‡∏°‡πà reload)
                            box.remove();
                        });
                    });
                });
            </script>

    </body>

    </html>