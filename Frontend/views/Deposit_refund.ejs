<%- include('includes/head') %>
    <link rel="stylesheet" href="/styles/adminDeposit.css">
    </head>

    <body>
        <%- include('includes/navAdmin') %>

            <main class="section-p1">
                <h2>üí∏ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≠‡∏Ñ‡∏∑‡∏ô‡∏°‡∏±‡∏î‡∏à‡∏≥</h2>

                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏ä‡πà‡∏≤</th>
                            <th>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡πà‡∏≤</th>
                            <th>‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                            <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏°‡∏±‡∏î‡∏à‡∏≥ (‡∏ø)</th>
                            <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏∑‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                            <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                            <th>‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∑‡∏ô‡∏°‡∏±‡∏î‡∏à‡∏≥</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% rentals .filter(r=> r.rental_status === "RETURNED")
                            .forEach(r => { %>
                            <tr>
                                <td>
                                    <%= r.rental_id %>
                                </td>
                                <td>
                                    <%= r.customer?.name %>
                                        <%= r.customer?.last_name %>
                                </td>
                                <td>
                                    <%= r.product?.product_name %>
                                </td>
                                <td>
                                    <%= r.deposit_amount || 0 %>
                                </td>
                                <td>
                                    <%= r.return_date ? r.return_date.toLocaleDateString() : '-' %>
                                </td>
                                <td><span class="status returned">‡∏Ñ‡∏∑‡∏ô‡πÅ‡∏•‡πâ‡∏ß</span></td>
                                <td>
                                    <button class="btn refund-btn" data-rental-id="<%= r.rental_id %>"
                                        data-customer="<%= r.customer?.name %>" data-amount="<%= r.deposit_amount %>">
                                        ‡∏Ñ‡∏∑‡∏ô‡∏°‡∏±‡∏î‡∏à‡∏≥
                                    </button>
                                </td>
                            </tr>
                            <% }) %>
                    </tbody>
                </table>
            </main>

            <!-- ‚úÖ Popup ‡∏Ñ‡∏∑‡∏ô‡∏°‡∏±‡∏î‡∏à‡∏≥ -->
            <div id="refund-popup" class="popup" style="display:none;">
                <div class="popup-content">
                    <h3>üí∏ ‡∏Ñ‡∏∑‡∏ô‡∏°‡∏±‡∏î‡∏à‡∏≥</h3>

                    <form id="refundForm" enctype="multipart/form-data">
                        <input type="hidden" id="refund-rental-id" name="rental_id">
                        <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏∑‡∏ô:</label>
                        <input type="number" id="refund-amount" name="refund_amount" required>

                        <label>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ (‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö):</label>
                        <textarea id="refund-note" name="refund_note" rows="3"
                            placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ä‡∏∏‡∏î‡∏°‡∏µ‡∏£‡∏≠‡∏¢‡∏Ç‡∏≤‡∏î ‡∏£‡∏≠‡∏¢‡πÄ‡∏õ‡∏•‡∏∑‡πâ‡∏≠‡∏ô‡∏ã‡∏±‡∏Å‡πÑ‡∏°‡πà‡∏≠‡∏≠‡∏Å"></textarea>

                        <label>‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏á‡∏¥‡∏ô:</label>
                        <input type="file" id="refund-slip" name="refund_slip" accept="image/*" required>

                        <div class="popup-actions">
                            <button type="submit" class="btn primary">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∑‡∏ô‡∏°‡∏±‡∏î‡∏à‡∏≥</button>
                            <button type="button" id="cancel-refund" class="btn gray">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                        </div>
                    </form>
                </div>
            </div>


            <script src="/js/adminDeposit.js"></script>
    </body>

    </html>