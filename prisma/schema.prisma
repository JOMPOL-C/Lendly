generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Calender {
  rental_id       Int                     @id @default(autoincrement())
  customerId      Int
  productId       Int
  rental_date     DateTime?               @default(now()) @db.DateTime(0)
  rental_end_date DateTime?               @default(now()) @db.DateTime(0)
  rental_status   Calender_rental_status?
  rental_datetime DateTime?               @default(now()) @db.DateTime(0)
  rental_update   DateTime                @updatedAt

  // relations
  customer Customer @relation(fields: [customerId], references: [customer_id])
  product  Product  @relation(fields: [productId], references: [product_id])
  reports  Report[]

  @@index([customerId], map: "FK_customer_id_idx")
  @@index([productId], map: "FK_product_id")
}

model Category {
  category_id       String   @id @db.VarChar(9)
  category_name     String   @db.VarChar(45)
  category_datetime DateTime @default(now()) @db.DateTime(0)
  category_update   DateTime @updatedAt

  products Product[]
}

model Chat {
  chat_id          Int       @id @default(autoincrement())
  fk_chat_customer Int
  fk_chat_store    Int
  chat_detail      String?   @db.Text
  chat_datetime    DateTime? @default(now()) @db.DateTime(0)

  // relations
  customer Customer @relation(fields: [fk_chat_customer], references: [customer_id])
  store    Store    @relation(fields: [fk_chat_store], references: [store_id])

  @@index([fk_chat_customer], map: "FK_customer_id")
  @@index([fk_chat_store], map: "fk_chat_store_idx")
}

model County {
  county_id   Int    @id @default(autoincrement())
  county_name String @db.VarChar(40)

  products Product[]
}

model Customer {
  customer_id            Int      @id @default(autoincrement())
  fk_customer_proportion Int?
  name                   String   @db.VarChar(45)
  last_name              String   @db.VarChar(45)
  customer_email         String?  @unique(map: "customer_email_UNIQUE") @db.VarChar(45)
  customer_phone         String?  @unique(map: "customer_phone_UNIQUE") @db.VarChar(10)
  address                String?  @db.VarChar(255)
  id_card_number         String?  @unique(map: "id_card_number_UNIQUE") @db.VarChar(13)
  card_image             Bytes?   @db.Blob
  username               String   @unique(map: "username_UNIQUE") @db.VarChar(30)
  password               String   @db.VarChar(255)
  customer_datetime      DateTime @default(now()) @db.DateTime(0)
  customer_update        DateTime @updatedAt

  // relations
  proportion Proportion? @relation(fields: [fk_customer_proportion], references: [proportion_id])
  orders     Orders[]
  chats      Chat[]
  rentals    Calender[]
  reviews    Review[]
}

model Orders {
  order_id          Int      @id @default(autoincrement())
  fk_order_customer Int
  total_price       Decimal  @db.Decimal(10, 2)
  deposit_amount    Decimal? @db.Decimal(10, 2)

  // relations
  customer  Customer   @relation(fields: [fk_order_customer], references: [customer_id])
  payments  Payment[]
  shippings Shipping[]

  @@index([fk_order_customer], map: "fk_order_customer_idx")
}

model Payment {
  payment_id       Int       @id @default(autoincrement())
  fk_payment_order Int
  fk_payment_pmt   Int
  omise_charge_id  String    @db.VarChar(100)
  payment_date     DateTime? @default(now()) @db.DateTime(0)
  payment_amount   Decimal   @db.Decimal(10, 2)

  // relations
  order  Orders         @relation(fields: [fk_payment_order], references: [order_id])
  method Payment_method @relation(fields: [fk_payment_pmt], references: [payment_method_id])

  @@index([fk_payment_order], map: "fk_payment_order_idx")
  @@index([fk_payment_pmt], map: "fk_payment_pmt_idx")
}

model Payment_method {
  payment_method_id   Int     @id @default(autoincrement())
  payment_method_name String? @db.VarChar(45)

  payments Payment[]
}

model Product {
  product_id          Int      @id @default(autoincrement())
  fk_product_store    Int
  fk_product_pp       Int?
  fk_product_category String   @db.VarChar(9)
  fk_product_county   Int
  product_name        String   @db.VarChar(45)
  shipping_info       String?  @db.VarChar(255)
  rental_period       Int
  product_update      DateTime @updatedAt

  // relations
  store    Store               @relation(fields: [fk_product_store], references: [store_id])
  category Category            @relation(fields: [fk_product_category], references: [category_id])
  county   County              @relation(fields: [fk_product_county], references: [county_id])
  size     Proportion_product? @relation(fields: [fk_product_pp], references: [proportion_product_id])
  rentals  Calender[]
  reviews  Review[]
  reports  Report[]
  prices   ProductPrice[]

  @@index([fk_product_category], map: "category_id_idx")
  @@index([fk_product_county], map: "county_id_idx")
  @@index([fk_product_pp], map: "fk_product_pp_idx")
  @@index([fk_product_store], map: "store_id_idx")
}

model Proportion {
  proportion_id     Int      @id @default(autoincrement())
  chest             Decimal? @db.Decimal(5, 1)
  waist             Decimal? @db.Decimal(5, 1)
  hips              Decimal? @db.Decimal(5, 1)
  proportion_update DateTime @updatedAt

  customers Customer[]
}

model Proportion_product {
  proportion_product_id Int      @id @default(autoincrement())
  chest                 Decimal? @db.Decimal(5, 1)
  waist                 Decimal? @db.Decimal(5, 1)
  hips                  Decimal? @db.Decimal(5, 1)

  products Product[]
}

model Report {
  report_id         Int       @id @default(autoincrement())
  fk_report_product Int
  fk_report_rental  Int
  report_topics     String    @db.Text
  report_detail     String?   @db.Text
  report_file       Bytes?    @db.Blob
  report_fine       Decimal?  @db.Decimal(10, 2)
  report_datetime   DateTime? @default(now()) @db.DateTime(0)

  // relations
  product Product  @relation(fields: [fk_report_product], references: [product_id])
  rental  Calender @relation(fields: [fk_report_rental], references: [rental_id])

  @@index([fk_report_product], map: "fk_report_product_idx")
  @@index([fk_report_rental], map: "fk_report_rental_idx")
}

model Review {
  review_id          Int       @id @default(autoincrement())
  fk_review_customer Int
  fk_review_product  Int
  review_details     String?   @db.Text
  review_datetime    DateTime? @default(now()) @db.DateTime(0)
  review_score       Int       @db.TinyInt
  review_file        Bytes?    @db.Blob

  // relations
  customer Customer @relation(fields: [fk_review_customer], references: [customer_id])
  product  Product  @relation(fields: [fk_review_product], references: [product_id])

  @@index([fk_review_customer], map: "fk_review_customer_idx")
  @@index([fk_review_product], map: "fk_review_product_idx")
}

model Shipping {
  shipping_id       Int                       @id @default(autoincrement())
  fk_shipping_order Int
  tracking          String                    @db.VarChar(13)
  shipping_date     DateTime?                 @db.DateTime(0)
  shipping_status   Shipping_shipping_status?
  shipping_name     String?                   @db.VarChar(45)
  shipping_end_date DateTime?                 @default(now()) @db.DateTime(0)

  // relations
  order Orders @relation(fields: [fk_shipping_order], references: [order_id])

  @@index([fk_shipping_order], map: "fk_shipping_order_idx")
}

model Store {
  store_id    Int     @id @default(autoincrement())
  store_name  String  @db.VarChar(45)
  store_email String? @db.VarChar(45)
  store_phone String? @db.VarChar(10)

  products Product[]
  chats    Chat[]
}

model ProductPrice {
  productPrice_id Int                 @id @default(autoincrement())
  productId       Int
  type            ProductPrice_status
  price_pri       Decimal             @db.Decimal(10, 2)
  price_test      Decimal             @db.Decimal(10, 2)

  // Relation
  product Product @relation(fields: [productId], references: [product_id])

  @@index([productId], map: "fk_Product_ProductPrice_idx")
}

enum Shipping_shipping_status {
  IN_PROGRESS @map("กำลังจัดส่ง")
  DELIVERED   @map("จัดส่งสำเร็จ")
}

enum Calender_rental_status {
  PENDING_PAYMENT @map("รอชำระเงิน")
  RENTED          @map("กำลังเช่า")
  RETURNED        @map("คืนแล้ว")
  CANCELLED       @map("ยกเลิก")
}

enum ProductPrice_status {
  suit       @map("ชุด")
  wig        @map("วิก")
  suit_wig   @map("ชุด+วิก")
  addon_prop @map("พร็อพเสริม")
  addon_shoe @map("รองเท้า")
  solo_prop  @map("พร็อพเดี่ยว")
  solo_shoe  @map("รองเท้าเดี่ยว")
}
